{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Multi-key discriminator test schema",
  "in": {
    "type": "object",
    "properties": {
      "action": {
        "type": "string",
        "enum": ["process", "upload"],
        "description": "Action to perform"
      },
      "mode": {
        "type": "string",
        "enum": ["sync", "async"],
        "description": "Execution mode"
      }
    },
    "required": ["action"],
    "allOf": [
      {
        "if": {
          "properties": {
            "action": { "const": "process" },
            "mode": { "const": "sync" }
          }
        },
        "then": {
          "properties": {
            "timeout": {
              "type": "integer",
              "description": "Timeout in seconds"
            }
          }
        }
      },
      {
        "if": {
          "properties": {
            "action": { "const": "upload" }
          }
        },
        "then": {
          "properties": {
            "destination": {
              "type": "string",
              "description": "Upload destination path"
            }
          }
        }
      }
    ]
  },
  "out": {
    "type": "object",
    "properties": {
      "ok": {
        "type": "boolean",
        "description": "Whether the operation succeeded"
      }
    },
    "required": ["ok"]
  }
}
