<idea-plugin>
    <id>brig.concord.intellij</id>
    <name>Concord</name>
    <vendor>brig</vendor>

    <depends>com.intellij.modules.platform</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Breadcrumbs -->
        <breadcrumbsInfoProvider implementation="brig.concord.editor.ConcordBreadcrumbsProvider"/>

        <!-- Code style / formatting -->
        <virtualFileCustomDataProvider implementation="brig.concord.editing.CodeStyleSettingsCustomDataSynchronizer"/>
        <langCodeStyleSettingsProvider implementation="brig.concord.editing.CodeStyleSettingsProvider"/>

        <lang.formatter language="Concord" implementationClass="brig.concord.formatter.YAMLFormattingModelBuilder"/>
        <lang.commenter language="Concord" implementationClass="brig.concord.formatter.YAMLCommenter"/>
        <lang.whiteSpaceFormattingStrategy language="Concord"
                                           implementationClass="brig.concord.formatter.YamlWhiteSpaceFormattingStrategy"/>

        <stripTrailingSpacesFilterFactory implementation="brig.concord.formatter.YamlStripTrailingSpacesFilterFactory"/>

        <editor.backspaceModeOverride language="Concord"
                                      implementationClass="com.intellij.codeInsight.editorActions.SmartBackspaceDisabler"/>

        <!-- Editor smart actions -->
        <enterHandlerDelegate implementation="brig.concord.smart.ConcordEnterAtIndentHandler" order="first"/>

        <!-- Services / settings -->
        <applicationService serviceImplementation="brig.concord.smart.YAMLEditorOptions"/>
        <applicationSettings service="brig.concord.smart.YAMLEditorOptions"/>

        <projectService serviceImplementation="brig.concord.yaml.YAMLElementGenerator"/>

        <!-- Syntax highlighting / colors -->
        <lang.syntaxHighlighterFactory
                language="Concord"
                implementationClass="brig.concord.highlighting.ConcordSyntaxHighlighterFactory"/>

        <annotator
                language="Concord"
                implementationClass="brig.concord.highlighting.ConcordHighlightingAnnotator"/>

        <colorSettingsPage
                implementation="brig.concord.highlighting.ConcordColorSettingsPage"/>

        <!-- Color scheme additions -->
        <additionalTextAttributes scheme="Default" file="colorSchemes/ConcordDefault.xml"/>
        <additionalTextAttributes scheme="Darcula" file="colorSchemes/ConcordDarcula.xml"/>

        <!-- Language / file type -->
        <lang.parserDefinition language="Concord"
                               implementationClass="brig.concord.parser.ConcordYAMLParserDefinition"/>

        <fileType name="Concord File"
                  implementationClass="brig.concord.ConcordFileType"
                  fieldName="INSTANCE"
                  language="Concord"
                  extensions="concord.yml"
                  patterns="*.concord.yml;concord.yml;*.concord.yaml;concord.yaml"/>

        <!-- Folding -->
        <lang.foldingBuilder language="Concord" implementationClass="brig.concord.folding.CronExpressionFolding"/>
        <lang.foldingBuilder language="Concord"
                             id="YAMLFolding"
                             implementationClass="brig.concord.yaml.folding.YAMLFoldingBuilder"/>

        <!-- Find usages / usage types -->
        <iconProvider implementation="brig.concord.psi.ConcordIconProvider" order="first"/>
        <lang.findUsagesProvider language="Concord" implementationClass="brig.concord.usages.FindUsageProvider"/>
        <usageTypeProvider implementation="brig.concord.usages.FlowUsageTypeProvider"/>

        <!-- Refactoring -->
        <renamePsiElementProcessor implementation="brig.concord.refactoring.FlowDefinitionRenameProcessor"/>

        <!-- References / completion / structure view -->
        <psi.referenceContributor language="Concord" implementation="brig.concord.ConcordYamlReferenceContributor"/>
        <completion.contributor language="Concord"
                                implementationClass="brig.concord.completion.ConcordCompletions"
                                order="first"/>
        <completion.contributor language="Concord"
                                implementationClass="brig.concord.completion.FlowDocCompletionContributor"/>

        <multiHostInjector implementation="brig.concord.injection.ConcordLanguageInjector"/>

        <lang.psiStructureViewFactory language="Concord"
                                      implementationClass="brig.concord.structureView.ConcordStructureViewFactory"/>

        <!-- Navigation -->
        <fileBasedIndex implementation="brig.concord.navigation.FlowNamesIndex"/>
        <searchEverywhereContributor implementation="brig.concord.navigation.FlowDefinitionSearchEverywhereContributor$Factory"/>

        <!-- Call Hierarchy -->
        <callHierarchyProvider language="Concord"
                               implementationClass="brig.concord.hierarchy.FlowCallHierarchyProvider"/>

        <!-- Validation -->
        <annotator language="Concord"
                   implementationClass="brig.concord.yaml.annotator.YAMLInvalidBlockChildrenErrorAnnotator"/>


        <!-- inspections -->
        <localInspection language="Concord"
                         displayName="Unknown keys"
                         groupPath="Concord"
                         groupName="Structure"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="brig.concord.inspection.UnknownKeysInspection"/>
        <localInspection language="Concord"
                         displayName="Missing keys"
                         groupPath="Concord"
                         groupName="Structure"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="brig.concord.inspection.MissingKeysInspection"/>
        <localInspection language="Concord"
                         displayName="Scalar values"
                         groupPath="Concord"
                         groupName="Structure"
                         enabledByDefault="true"
                         level="ERROR"
                         implementationClass="brig.concord.inspection.ValueInspection"/>

        <localInspection language="Concord"
                         bundle="messages.ConcordBundle"
                         shortName="DuplicatedKeys"
                         level="ERROR"
                         key="inspections.duplicated.keys.name"
                         groupKey="inspections.group.name"
                         enabledByDefault="true"
                         implementationClass="brig.concord.inspection.DuplicatedKeysInspection"/>

        <localInspection language="Concord"
                         bundle="messages.ConcordBundle"
                         shortName="FlowDocumentation"
                         level="WARNING"
                         key="inspections.flow.documentation.name"
                         groupKey="inspections.group.name"
                         enabledByDefault="true"
                         implementationClass="brig.concord.inspection.FlowDocumentationInspection"/>

        <localInspection language="Concord"
                         bundle="messages.ConcordBundle"
                         shortName="DuplicateFlowName"
                         level="WARNING"
                         key="inspections.duplicate.flow.names.name"
                         groupKey="inspections.group.name"
                         enabledByDefault="true"
                         implementationClass="brig.concord.inspection.DuplicateFlowNameInspection"/>

        <notificationGroup id="Concord Notification Group" displayType="BALLOON" key="notification.group.concord"/>

        <editorNotificationProvider
                implementation="brig.concord.notification.OutOfScopeEditorNotificationProvider"/>

        <localInspection language="Concord"
                         bundle="messages.ConcordBundle"
                         shortName="OutOfScope"
                         level="WARNING"
                         key="inspections.out.of.scope.name"
                         groupKey="inspections.group.name"
                         enabledByDefault="true"
                         implementationClass="brig.concord.inspection.OutOfScopeInspection"/>
    </extensions>

</idea-plugin>
